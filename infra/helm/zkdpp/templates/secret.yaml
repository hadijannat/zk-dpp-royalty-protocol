{{/*
  NOTE: These secrets are created only when the chart is configured to manage secrets directly.
  For production, it's recommended to use external secret management (e.g., External Secrets Operator,
  Vault, or pre-created Kubernetes secrets) and reference them via:
    - secrets.databaseSecret
    - secrets.gatewaySigningSecret
    - secrets.blockchainSecret
*/}}

{{- if and .Values.config.databaseUrl (not .Values.secrets.databaseSecret) }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "zkdpp.fullname" . }}-database
  labels:
    {{- include "zkdpp.labels" . | nindent 4 }}
type: Opaque
data:
  DATABASE_URL: {{ .Values.config.databaseUrl | b64enc | quote }}
{{- end }}
---
{{- if .Values.secrets.createGatewaySigningKey }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "zkdpp.fullname" . }}-gateway-signing
  labels:
    {{- include "zkdpp.labels" . | nindent 4 }}
  annotations:
    "helm.sh/hook": pre-install
    "helm.sh/hook-delete-policy": before-hook-creation
type: Opaque
data:
  # NOTE: For production, generate a real Ed25519 private key and store it securely
  # This placeholder should be replaced with a proper secret management solution
  SIGNING_KEY_PRIVATE: {{ "" | b64enc | quote }}
{{- end }}
---
{{- if and .Values.config.blockchain.enabled .Values.secrets.createBlockchainKey }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "zkdpp.fullname" . }}-blockchain
  labels:
    {{- include "zkdpp.labels" . | nindent 4 }}
  annotations:
    "helm.sh/hook": pre-install
    "helm.sh/hook-delete-policy": before-hook-creation
type: Opaque
data:
  # NOTE: For production, NEVER store private keys in Helm values
  # Use a secrets manager like HashiCorp Vault or AWS Secrets Manager
  BLOCKCHAIN_PRIVATE_KEY: {{ "" | b64enc | quote }}
{{- end }}
